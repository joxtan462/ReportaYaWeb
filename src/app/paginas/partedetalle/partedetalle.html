<header class="header">
  <div class="logo-container">
    <img src="assets/Logo-San-Bernardo.png" alt="Municipalidad de San Bernardo" class="logo-muni" />
    <img src="assets/logo.png" alt="Sistema de Alertas" class="logo-app" />
  </div>

  <div class="user-greeting">
    <span style="color: white">Bienvenido, <strong>{{ usuarioNombre || 'Usuario' }}</strong> ({{ usuarioActual?.rango || 'Invitado' }})</span>
    <button class="btn-logout" (click)="cerrarSesion()">ğŸšª Cerrar SesiÃ³n</button>
  </div>
</header>

<div class="main-content">

  <!-- MENÃš LATERAL -->
  <aside class="sidebar">
    <nav>
      <ul>
        <li>
          <a [routerLink]="['/menu']" routerLinkActive="active">
            <span class="icon">ğŸ </span> MenÃº
          </a>
        </li>
        <li *ngIf="isCurrentRoute('/partedetalle')">
          <a [routerLink]="['/menu']" routerLinkActive="active">
            <span class="icon">ğŸ </span> MenÃº
          </a>
        </li>

        <!-- ğŸ”¹ Ruta: alertasvecinales -->
        <li *ngIf="puedeVer('alertasvecinales') && !isCurrentRoute('/alertasvecinales')">
          <a [routerLink]="['/alertasvecinales']" routerLinkActive="active">
            <span class="icon">ğŸš¨</span> Alertas Vecinales
          </a>
        </li>

        <!-- ğŸ”¹ Ruta: camarassolicitadas -->
        <li *ngIf="puedeVer('camarassolicitadas')">
          <a [routerLink]="['/camarassolicitadas']" routerLinkActive="active">
            <span class="icon">ğŸ“¹</span> CÃ¡maras Solicitadas
          </a>
        </li>

        <!-- ğŸ”¹ Ruta: mapa -->
        <li *ngIf="puedeVer('mapa')">
          <a [routerLink]="['/mapa']" routerLinkActive="active">
            <span class="icon">ğŸ—ºï¸</span> Mapa en Vivo
          </a>
        </li>

        <!-- ğŸ”¹ Ruta: multas -->
        <li *ngIf="puedeVer('multas')">
          <a [routerLink]="['/multas']" routerLinkActive="active">
            <span class="icon">ğŸ’°</span> Multas
          </a>
        </li>

        <!-- ğŸ”¹ Ruta: crearusuario (solo para admin) -->
        <li *ngIf="puedeVer('crearusuario')">
          <a [routerLink]="['/crearusuario']" routerLinkActive="active">
            <span class="icon">ğŸ‘¥</span> Crear Usuario
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="main-area">
    <div class="detalle-container">
      <div class="detalle-header">
        <h2>
          <span class="icon">ğŸ’°</span> Detalle de Parte
        </h2>
        <div class="actions-toolbar">
          <button class="btn-secondary" (click)="volver()">
            â† Volver
          </button>
          <button class="btn-danger" (click)="eliminarMulta(multa?.id)" *ngIf="esAdmin()">
            ğŸ—‘ï¸ Eliminar
          </button>
        </div>
      </div>

      <!-- PESTAÃ‘AS -->
      <div class="tabs-container">
        <div class="tabs">
          <button class="tab-btn" [class.active]="tabActual === 'general'" (click)="cambiarTab('general')">
            <span class="icon">ğŸ“‹</span> General
          </button>
          <button class="tab-btn" [class.active]="tabActual === 'imagenes'" (click)="cambiarTab('imagenes')">
            <span class="icon">ğŸ“·</span> ImÃ¡genes
          </button>
          <button class="tab-btn" [class.active]="tabActual === 'creador'" (click)="cambiarTab('creador')">
            <span class="icon">ğŸ‘¤</span> Creador
          </button>
          <button class="tab-btn" [class.active]="tabActual === 'comentarios'" (click)="cambiarTab('comentarios')">
            <span class="icon">ğŸ’¬</span> Comentarios
          </button>
          <button class="tab-btn" [class.active]="tabActual === 'acciones'" (click)="cambiarTab('acciones')" *ngIf="esAdmin()">
            <span class="icon">ğŸ”§</span> Acciones
          </button>
        </div>

        <!-- CONTENIDO DE CADA PESTAÃ‘A -->
        <div class="tab-content">
          <!-- PESTAÃ‘A: General -->
          <div *ngIf="tabActual === 'general'" class="tab-pane">
            <div class="field">
              <label>ID:</label>
              <span class="value monospace">{{ multa?.id || 'N/A' }}</span>
            </div>
            <div class="field">
              <label>Fecha:</label>
              <span class="value">{{ multa?.fechaFormateada || 'No disponible' }}</span>
            </div>
            <div class="field">
              <label>UbicaciÃ³n:</label>
              <span class="value">{{ multa?.ubicacion || 'No especificada' }}</span>
            </div>
            <div class="field">
              <label>Patente:</label>
              <span class="value">{{ multa?.patente || 'No especificada' }}</span>
            </div>
            <div class="field">
              <label>Marca:</label>
              <span class="value">{{ multa?.marca || 'No especificada' }}</span>
            </div>
            <div class="field">
              <label>Color:</label>
              <span class="value">{{ multa?.color || 'No especificado' }}</span>
            </div>
            <div class="field">
              <label>Tipo:</label>
              <span class="value">{{ multa?.tipo || 'No especificado' }}</span>
            </div>
            <div class="field">
              <label>InfracciÃ³n:</label>
              <span class="value">{{ multa?.infraccion || 'No especificada' }}</span>
            </div>
          </div>

          <!-- PESTAÃ‘A: ImÃ¡genes -->
          <div *ngIf="tabActual === 'imagenes'" class="tab-pane">
            <div class="foto-container" *ngIf="multa?.fotos && multa.fotos.length > 0">
              <div *ngFor="let foto of multa.fotos" class="foto-item">
                <img [src]="foto" alt="Foto del parte" class="foto-pequena" />
              </div>
            </div>
            <div class="no-foto" *ngIf="!(multa?.fotos?.length > 0)">
              <span>ğŸ“· Sin imÃ¡genes disponibles</span>
            </div>
          </div>

          <!-- PESTAÃ‘A: Creador -->
          <div *ngIf="tabActual === 'creador'" class="tab-pane">
            <div class="field">
              <label>Nombre:</label>
              <span class="value">{{ usuarioNombre || 'Desconocido' }}</span>
            </div>
            <div class="field">
              <label>UID:</label>
              <span class="value monospace">{{ multa?.usuarioUID || 'N/A' }}</span>
            </div>
            <div class="field">
              <label>Email:</label>
              <span class="value">{{ multa?.usuarioEmail || 'Sin correo' }}</span>
            </div>
          </div>

          <!-- PESTAÃ‘A: Comentarios -->
          <div *ngIf="tabActual === 'comentarios'" class="tab-pane">
            <div class="field">
              <label>Comentarios:</label>
              <textarea
                [(ngModel)]="multa.comentarios"
                (input)="guardarCambios('comentarios')"
                [disabled]="!esAdmin()"
                rows="4"
              ></textarea>
            </div>
          </div>

          <!-- PESTAÃ‘A: Acciones -->
          <div *ngIf="tabActual === 'acciones'" class="tab-pane">
            <div class="acciones-content">
              <h4>Acciones Administrativas</h4>
              <div class="accion-item">
                <p>Eliminar este parte</p>
                <button class="btn-danger" (click)="eliminarMulta(multa?.id)">
                  ğŸ—‘ï¸ Eliminar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>